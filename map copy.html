
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>		
    <style type="text/css">



			#selector, #yearSelect {
				top:50px;
				left: 1024px;
				height: 20px;
				width: 118px;
				color: white;
				margin-bottom:10px;
				margin-right:25px;
			}

			#selector {
				float:right;
			}

			#yearSelect {
				float:left;
			}

			#button {
				text-align:center;
			}

			 
			body, #map {
				left: 4px;
			  	width: 99%;
			  	height: 100%;
			 	padding: 0px;
			 	position:fixed;
			}
			 
			.stations, .stations svg {
			  position: absolute;
			}
			 
			.stations svg {
			  width: 60px;
			  height: 20px;
			  padding-right: 100px;
			  font: 10px sans-serif;
			}
			 
			.stations circle {
			  fill: red;
			  stroke: lightblue;
			  stroke-width: 1.5px;
			}
		</style>
	</head>

	
<!--
<script>
var e = document.getElementById("yearSelect");
var strUser = e.options[e.selectedIndex].text;
document.write(strUser);
</script>
-->
<p style="text-align:center;color:gray;font-family:arial;font-size:20px;"> Patent Mapping </p>

<head>
	<script type="text/javascript">
	function populateYears(first, last) {
		var optionList = document.getElementById('yearSelect').options;
		for (i = 0; (first + i) <= last; i++) {
			optionList[i] = new Option(first + i, first + i);
		}
	}
	</script>
</head>


<body onload="populateYears(1975,2010)">
<select id="yearSelect"></select>
</body>



<body id="button"><button onclick="refresh_state()">Map</button></body>

<body>

	<div id="selector">	

		<form action="www.nba.com" method="post">		
			<select name="state[]" id="state"> 
			<option value="" selected>-- Select One --</option>
			<option value="AL">Alabama</option>
			<option value="AK">Alaska</option>
			<option value="AZ">Arizona</option>
			<option value="AR">Arkansas</option>
			<option value="CA">California</option>
			<option value="CO">Colorado</option>
			<option value="CT">Connecticut</option>
			<option value="DE">Delaware</option>
			<option value="DC">District of Columbia</option>
			<option value="FL">Florida</option>
			<option value="GA">Georgia</option>
			<option value="HI">Hawaii</option>
			<option value="ID">Idaho</option>
			<option value="IL">Illinois</option>
			<option value="IN">Indiana</option>
			<option value="IA">Iowa</option>
			<option value="KS">Kansas</option>
			<option value="KY">Kentucky</option>
			<option value="LA">Louisiana</option>
			<option value="ME">Maine</option>
			<option value="MD">Maryland</option>
			<option value="MA">Massachusetts</option>
			<option value="MI">Michigan</option>
			<option value="MN">Minnesota</option>
			<option value="MS">Mississippi</option>
			<option value="MO">Missouri</option>
			<option value="MT">Montana</option>
			<option value="NE">Nebraska</option>
			<option value="NV">Nevada</option>
			<option value="NH">New Hampshire</option>
			<option value="NJ">New Jersey</option>
			<option value="NM">New Mexico</option>
			<option value="NY">New York</option>
			<option value="NC">North Carolina</option>
			<option value="ND">North Dakota</option>
			<option value="OH">Ohio</option>
			<option value="OK">Oklahoma</option>
			<option value="OR">Oregon</option>
			<option value="PA">Pennsylvania</option>
			<option value="RI">Rhode Island</option>
			<option value="SC">South Carolina</option>
			<option value="SD">South Dakota</option>
			<option value="TN">Tennessee</option>
			<option value="TX">Texas</option>
			<option value="UT">Utah</option>
			<option value="VT">Vermont</option>
			<option value="VA">Virginia</option>
			<option value="WA">Washington</option>
			<option value="WV">West Virginia</option>
			<option value="WI">Wisconsin</option>
			<option value="WY">Wyoming</option>
			</select>  
		</form>
	</div>
    <div id="map"></div>
    <div id="draggable" class="ui-widget-content" style="position:absolute; 
			top:40px; right:40px; z-index:2000; width:300px; height:480px; padding:10px;
			font-size:10px; font-family:sans-serif;
			border:3px solid;
			background-color:rgba(255,255,255,0.86);
			">
			<form>
			<div style="font-size:12px; text-align:center;">
			<b>The Distribution of Clean Tech Patents</b>
			</div>
			<hr>
			<div style="margin-left:5px;">
			<b>Assignee Type</b><br>
			<!-- 'lone inventor','venture backed firms','small & medium firms','academic','governmental','large firms' -->
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[0]=!aatype[0];redraw_map();redraw_bar();'>lone inventor
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[1]=!aatype[1];redraw_map();redraw_bar();'>venture backed firms<br>
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[2]=!aatype[2];redraw_map();redraw_bar();'>small &amp; medium firms
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[3]=!aatype[3];redraw_map();redraw_bar();'>academic<br>
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[4]=!aatype[4];redraw_map();redraw_bar();'>governmental
			<input type="checkbox" name="vehicle" checked="yes" onchange='aatype[5]=!aatype[5];redraw_map();redraw_bar();'>large firms
			</div>
			<hr>
			<!--
			<div style="margin-left:5px;">
			<b>Clean Type</b><br>
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_solar.png">solar power
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_wind.png">wind power<br>
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_biofuel.png">biofuel
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_geo.png">geothermal<br>
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_hydro.png">hydroelectricity
			<input type="checkbox" name="vehicle" checked="yes" value="Bike"><img src="./icon_nuclear.png">nuclear
			</div>
			<br>
			<hr>
			-->

			</form>
			
<div>

<script type="text/javascript">
	
	function refresh_state() {
		var year_val = document.getElementById("yearSelect");
		var year = year_val.options[year_val.selectedIndex].text;
		if ($("#state").val().length == 0) {
			alert("Please select a state.");
		}
		//window.location.replace("./map5.html");
		// Load the station data. When the data comes back, create an overlay.

		$.ajax({
			url: "http://127.0.0.1:5000/" + $('#state').val() + '/' + year,
			dataType: "jsonp",
			crossDomain: true,
			success: function(data) {
				alert("Please zoom in!");
				//console.log(data);
			},
			error: function(data) {
				alert("Error!");
			}
		});


		d3.json("http://127.0.0.1:5000/" + $('#state').val() + '/' + year, function(data) {
			//document.write(data.length);
			var map = new google.maps.Map(d3.select("#map").node(), {
				zoom: 5,
				center: new google.maps.LatLng(37.76487, -122.41948),
				mapTypeId: google.maps.MapTypeId.TERRAIN
			});
			var overlay = new google.maps.OverlayView();
		  // Add the container when the overlay is added to the map.
		  overlay.onAdd = function() {
		    var layer = d3.select(this.getPanes().overlayLayer).append("div")
			.attr("class", "stations");
		 
		    // Draw each marker as a separate SVG element.
		    // We could use a single SVG, but what size would it have?
		    overlay.draw = function() {
		      var projection = this.getProjection(),
			  padding = 10;
		 
		      var marker = layer.selectAll("svg")
			  .data(d3.entries(data))
			  .each(transform) // update existing markers
			  .enter().append("svg:svg")
			  .each(transform)
			  .attr("class", "marker");
		 
		      // Add a circle.
		      marker.append("svg:circle")
			  .attr("r", 4.5)
			  .attr("cx", padding)
			  .attr("cy", padding);
		 
		      // Add a label.
		      marker.append("svg:text")
			  .attr("x", padding + 7)
			  .attr("y", padding)
			  .attr("dy", ".31em")
			  .text(function(d) { return d.key; });
		 
		      function transform(d) {
				d = new google.maps.LatLng(d.value[1], d.value[0]);
				d = projection.fromLatLngToDivPixel(d);
				return d3.select(this)
				    .style("left", (d.x - padding) + "px")
				    .style("top", (d.y - padding) + "px");
		      }
		    };
		  };
		 
		  // Bind our overlay to the map…
		  overlay.setMap(map);
		}
	)}

	// Create the Google Map…
	var map = new google.maps.Map(d3.select("#map").node(), {
	  zoom: 8,
	  center: new google.maps.LatLng(37.76487, -122.41948),
	  mapTypeId: google.maps.MapTypeId.TERRAIN
	});
	 
	
 
    </script>
  </body>
</html>
